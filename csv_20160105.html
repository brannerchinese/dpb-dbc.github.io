<!DOCTYPE html>
<html>
  <head>
    <!-- Template from https://github.com/gnab/remark, 20151228 -->
    <title>Title</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# Dealing with Comma-Separated Values (CSV)
## David Branner, Dev Bootcamp
### 20160105

---

# What these slides cover

 1. What is CSV?
--


 1. Two Basic Recipes for Dealing with CSV Files: Input
--


 1. Two Basic Recipes for Dealing with CSV Files: Output

---

## What is CSV?
--


Comma-Separated Values (CSV) is a simple format for storing data in flat text-files.
--


It's not a very safe format, because if the data itself contains commas, the file can become corrupt.
--


Using tab-separated values is safer, since tabs rarely occur in ordinary data.
--


However, CSV remains widely used because it is one of the export formats used by Microsoft Excel.

---

## Two Basic Recipes for Dealing with CSV Files: Input
--


I've saved some CSV data to a file, `temp.csv`. 
--


To read the lines of a CSV file, use `CSV.foreach`, as illustrated below.
--


Note that Ruby's `CSV` library doesn't have a `map` method built-in, so we have to declare an array first and successively push each line into it.
--

```ruby
require 'CSV'         # CSV is not in the standard library
content = []          # CSV does not have a `map` method
filename = 'temp.csv'

CSV.foreach(filename) do |line|
  content.push(line)
end
```

---

## Two Basic Recipes for Dealing w/ CSV Files: Input, cont'd
--


Here are the first two elements of the `content` array that we filled:

```ruby
[2] pry(main)> content[0]
=> ["id", "first_name", "last_name", "email", "phone", "created_at"]
[3] pry(main)> content[1]
=> ["1",
 "Lani",
 "Rollins",
 "blandit@quam.com",
 "1-633-389-7173",
 "2012-05-10T03:53:40-07:00"]
```
--

For comparison, here are the first two lines of the original file:
--

```text
id,first_name,last_name,email,phone,created_at
1,Lani,Rollins,blandit@quam.com,1-633-389-7173,2012-05-10T03:53:40-07:00
```
--

The `CSV` class converts each comma-separated item to a discrete element in the output subarray.

---

## Two Basic Recipes for Dealing with CSV Files: Output
--

For output, I first create an array of hashes, and then pass each hash in turn to a `CSV` writer-object (called `csv` here), also passing an output-filename and the string `'wb'` to it for writing in bytes:

```ruby
items = [{first: 'primero', second: 'segundo', third: 'tercera'},
  {first: 'pierwszy', second: 'sekunda', third: 'trzeci'},
  {first: '第一', second: '第二', third: '第三'},
]

CSV.open('output.csv', 'wb') do |csv|
  items.each { |item| csv << [ item[:first], item[:second], item[:third] ] }
end
```
--

Notice that the `CSV` object takes an array as input. If you wish to pass a single string to the `CSV` object, you must place it into an array: `csv << [ item ]`.
--


For comparison, here's the content of the output file `output.csv`:
--

```text
primero,segundo,tercera
pierwszy,sekunda,trzeci
第一,第二,第三
```

---

class: center, middle

## END

    </textarea>
    <script src="https://gnab.github.io/remark/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>

<!-- From http://joshbode.github.io/remark/ansi.html#3, 20151229 -->
    <script src="http://gnab.github.io/remark/downloads/remark-latest.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script type="text/javascript">
      var hljs = remark.highlighter.engine;
    </script>
    <script src="terminal.language.js" type="text/javascript"></script>
    <script type="text/javascript">
      var slideshow = remark.create({
        highlightStyle: 'solarized_dark'
      });
      // extract the embedded styling from ansi spans
      $('code.terminal > span.hljs-ansi').replaceWith(function(i, x) {
        return x.replace(/<(\/?(\w+).*?)>/g, '<$1>')
      });
    </script>
  </body>
</html>
